# GrowthMindz Admin Server Setup Instructions

## Database Setup

1. **Create the admin-related tables in your existing PostgreSQL database**

   Run the following SQL commands in your PostgreSQL database (`grw_db`):

   ```sql
   -- Admins table
   CREATE TABLE IF NOT EXISTS admins (
       id SERIAL PRIMARY KEY,
       name VARCHAR(255) NOT NULL,
       email VARCHAR(255) UNIQUE NOT NULL,
       password VARCHAR(255) NOT NULL,
       phone VARCHAR(20),
       created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
   );

   -- Staff table
   CREATE TABLE IF NOT EXISTS staff (
       id SERIAL PRIMARY KEY,
       name VARCHAR(255) NOT NULL,
       email VARCHAR(255) UNIQUE NOT NULL,
       password VARCHAR(255) NOT NULL,
       phone VARCHAR(20),
       created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
   );

   -- Videos table (if it doesn't exist)
   CREATE TABLE IF NOT EXISTS videos (
       id SERIAL PRIMARY KEY,
       course_id INTEGER REFERENCES courses(id) ON DELETE CASCADE,
       title VARCHAR(255) NOT NULL,
       description TEXT,
       video_url TEXT,
       created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
   );

   -- Quizzes table (if it doesn't exist)
   CREATE TABLE IF NOT EXISTS quizzes (
       id SERIAL PRIMARY KEY,
       course_id INTEGER REFERENCES courses(id) ON DELETE CASCADE,
       title VARCHAR(255) NOT NULL,
       question TEXT NOT NULL,
       option_a VARCHAR(255) NOT NULL,
       option_b VARCHAR(255) NOT NULL,
       option_c VARCHAR(255) NOT NULL,
       option_d VARCHAR(255) NOT NULL,
       correct_answer VARCHAR(1) NOT NULL CHECK (correct_answer IN ('A', 'B', 'C', 'D')),
       created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
   );

   -- User progress table (if it doesn't exist)
   CREATE TABLE IF NOT EXISTS user_progress (
       id SERIAL PRIMARY KEY,
       user_id INTEGER REFERENCES users(id) ON DELETE CASCADE,
       course_id INTEGER REFERENCES courses(id) ON DELETE CASCADE,
       progress INTEGER DEFAULT 0 CHECK (progress >= 0 AND progress <= 100),
       updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
   );
   ```

2. **Generate admin password hash and insert admin account**

   Run the setup script:
   ```bash
   node setup-admin.js
   ```

   This will generate a bcrypt hash for the password `admin@1234`.

   Then insert the admin account into the database:
   ```sql
   INSERT INTO admins (name, email, password, phone) 
   VALUES (
       'Admin User', 
       'admin@growthmindz.com', 
       'PASTE_THE_HASHED_PASSWORD_HERE', 
       '+1 234-567-8900'
   );
   ```

   **Note:** Make sure to replace `PASTE_THE_HASHED_PASSWORD_HERE` with the actual hash generated by the script.

## Starting the Server

```bash
cd GrowthMindzAdmin-server
npm install  # (Already done if you followed the setup)
npm start
```

The server will run on `http://localhost:5001`

## Testing

### Test Admin Login

Make a POST request to `http://localhost:5001/api/admin/login`:

```json
{
  "email": "admin@growthmindz.com",
  "password": "admin@1234",
  "role": "Admin"
}
```

Expected response:
```json
{
  "message": "Login successful",
  "token": "eyJhbGc...",
  "user": {
    "id": 1,
    "name": "Admin User",
    "email": "admin@growthmindz.com",
    "role": "Admin"
  }
}
```

## Admin Account Credentials

- **Email:** admin@growthmindz.com
- **Password:** admin@1234
- **Role:** Admin

## API Endpoints

All endpoints except login require authentication via JWT token in the Authorization header:
```
Authorization: Bearer YOUR_JWT_TOKEN
```

### Authentication
- `POST /api/admin/login` - Login (no auth required)

### Dashboard
- `GET /api/admin/dashboard/stats` - Get statistics

### Users
- `GET /api/admin/users` - Get all users

### Courses
- `GET /api/admin/courses` - Get all courses
- `POST /api/admin/courses` - Add course
- `DELETE /api/admin/courses/:id` - Delete course
- `POST /api/admin/courses/:id/videos` - Add video
- `POST /api/admin/courses/:id/quizzes` - Add quiz

### Staff
- `GET /api/admin/staff` - Get all staff
- `POST /api/admin/staff` - Add staff
- `PUT /api/admin/staff/:id` - Update staff
- `DELETE /api/admin/staff` - Delete staff (bulk)
